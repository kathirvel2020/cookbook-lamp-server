<VirtualHost *:80>
  ServerName <%= @params[:server_name] %>
  DocumentRoot <%= @params[:docroot] %>/current/client/build
  Alias /api <%= @params[:docroot] %>/current/server/public/index.php/api

  <Directory <%= @params[:docroot] %>/current/server/public>
    Options Indexes FollowSymLinks MultiViews ExecCGI
    DirectoryIndex index.php
    AllowOverride all

    <IfVersion >= 2.4>
      Require all granted
    </IfVersion>
    <IfVersion < 2.4>
      Order allow,deny
      Allow from all
    </IfVersion>
  </Directory>

  <Directory <%= @params[:docroot] %>/current/client/build>
    Options Indexes FollowSymLinks
    DirectoryIndex index.html
    AllowOverride all

    <IfVersion >= 2.4>
      Require all granted
    </IfVersion>
    <IfVersion < 2.4>
      Order allow,deny
      Allow from all
    </IfVersion>

    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.html [L]
  </Directory>

  ErrorLog /var/log/apache2/<%= @params[:name] %>-error.log
  CustomLog /var/log/apache2/<%= @params[:name] %>-access.log combined
</VirtualHost>
